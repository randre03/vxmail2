{
  "name": "mailin",
  "version": "0.0.11",
  "description": "Artisanal inbound emails for every web app",
  "main": "index.js",
  "bin": {
    "mailin": "./run-cli.js"
  },
  "scripts": {
    "test": "grunt test",
    "start": "./run-cli.js"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/Flolagale/mailin.git"
  },
  "keywords": [
    "incoming",
    "inbound",
    "email",
    "parse",
    "smtp",
    "easy",
    "webhook",
    "post"
  ],
  "author": {
    "name": "Florent Galland"
  },
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/Flolagale/mailin/issues"
  },
  "homepage": "https://github.com/Flolagale/mailin",
  "dependencies": {
    "async": "^0.2.10",
    "cheerio": "^0.13.1",
    "commander": "^2.1.0",
    "forever-monitor": "^1.2.3",
    "form-data": "^0.1.2",
    "languagedetect": "^1.1.0",
    "lodash": "^2.4.1",
    "mailparser": "^0.4.1",
    "request": "^2.34.0",
    "shelljs": "^0.2.6",
    "simplesmtp": "^0.3.23",
    "spamc": "0.0.3",
    "winston": "^0.7.2"
  },
  "devDependencies": {
    "express": "^3.4.8",
    "grunt": "^0.4.4",
    "grunt-contrib-jshint": "^0.9.2",
    "grunt-jsbeautifier": "~0.1.9",
    "grunt-mocha-test": "^0.10.0",
    "mailcomposer": "^0.2.8",
    "multiparty": "^3.2.4",
    "should": "^3.1.3"
  },
  "readme": "#Mailin\n\n__Artisanal inbound emails for every web app__\n<img align=\"right\" src=\"postman.jpg\"/>\n\nMailin is an smtp server that listens for emails, parses them and posts them as json to the url of your choice.\nIt checks the incoming emails [dkim](http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail), [spf](http://en.wikipedia.org/wiki/Sender_Policy_Framework), spam score (using [spamassassin](http://spamassassin.apache.org/)) and tells you in which language the email is written.\n\nMailin can be used as a standalone application directly from the command line, or embedded inside a node application.\n\nMailin relies heavily on the excellent work of [@andris9](https://github.com/andris9) for the smtp and mail parsing services.\n\nWhy? Because we needed it for our startup [jokund.com](http://jokund.com).\n\n### Show me a demo!\nSure! A demo is live at [mailin.io](http://mailin.io). Please notice that it is running on the smallest Digital Ocean instance, so be fair if it is overloaded.\n\n###Initial setup\n\n####Dependencies\n\nMailin can run without any dependencies other than node itself, but having them allow you to use some additional features.\n\nSo first make sure the node is available, and the ```node``` command as well. On Debian/Ubuntu boxes:\n```\nsudo aptitude install nodejs ; sudo ln -s $(which nodejs) /usr/bin/node\n```\n\nTo handle dkim and spf checking, Mailin depends on Python 2.7. On Linux machines, it is very not likely that you don't have a decent version of Python available.\n\nTo handle the spam score computation, Mailin depends on spamassassin and its server interface spamc. Both should be available as packages on your machine. For instance on Debian/Ubuntu boxes:\n```\nsudo aptitude install spamassassin spamc\n```\nSpamassassin is not enabled by default, enable it in ```/etc/default/spamassassin```.\n\n####The crux: setting up your DNS correctly\n\nIn order to receive emails, your smtp server address should be made available somewhere. Two records should be added to your DNS records. Let us pretend that we want to receive emails at ```*@subdomain.domain.com```:\n* First an MX record: ```subdomain.domain.com MX 10 mxsubdomain.domain.com```. This means that the mail server for addresses like ```*@subdomain.domain.com``` will be ```mxsubdomain.domain.com```.\n* Then an A record: ```mxsubdomain.domain.com A the.ip.address.of.your.mailin.server```. This tells at which ip address the mail server can be found.\n\nYou can fire up Mailin (see next section) and use an [smtp server tester](http://mxtoolbox.com/diagnostic.aspx) to verify that everything is correct.\n\n\n###Using Mailin\n####From the command line\n\nInstall mailin globally.\n\n```\nsudo npm install -g mailin\n```\n\nRun it, specifying your webhook url (addtionnal help can be found using ```mailin --help```). By default, Mailin will listen on port 25, the standard smtp port. you can change this port for testing purpose using the ```--port``` option. However, do not change this port if you want to receive emails from the real world.\n\nPorts number under 1000 are reserved to root user. So two options here. Either run Mailin as root:\n```\nsudo mailin --webhook http://mydomain.com/incoming_emails\n```\nOr, prefered choice, use something like ```authbind``` to run Mailin with a standard user while still using port 25.\nHere comes a [tutorial on how to setup authbind](http://respectthecode.tumblr.com/post/16461876216/using-authbind-to-run-node-js-on-port-80-with-dreamhost). In this case, do something like:\n```\nauthbind --deep mailin --webhook http://mydomain.com/incoming_emails\n```\nand make sure the your user can write to the log file.\n\nAt this point, Mailin will listen for incoming emails, parse them and post an urlencoded form ```multipart/form-data``` to your webhook url.\n\n#####Webhook format\nThe webhook payload is a multipart form with a ```mailinMsg``` fields always present and some optionnal additional fields containing the content of the attachements. How to handle this? We got you covered, there is a working example using node and express in [mailin/test/utils/server.js](https://github.com/Flolagale/mailin/blob/master/test/utils/server.js). Anyway, once parsed, you should end up with something like:\n```\n{\n  mailinMsg:\n  {\n      html: '<div><b>Hello world!</b></div>',\n      text: 'Hello world!',\n      headers: {\n          from: 'John Doe <john.doe@somewhere.com>',\n          to: 'Jane Doe <jane.doe@somewhereelse.com>',\n          'content-type': 'multipart/mixed; boundary=\"----mailcomposer-?=_1-1395066415427\"',\n          'mime-version': '1.0'\n      },\n      priority: 'normal',\n      from: [{\n          address: 'john.doe@somewhere.com',\n          name: 'John Doe'\n      }],\n      to: [{\n          address: 'jane.doe@somewhereelse.com',\n          name: 'Jane Doe'\n      }],\n      attachments: [{\n          contentType: 'text/plain',\n          fileName: 'dummyFile.txt',\n          contentDisposition: 'attachment',\n          transferEncoding: 'base64',\n          generatedFileName: 'dummyFile.txt',\n          contentId: '6e4a9c577e603de61e554abab84f6297@mailparser',\n          checksum: 'e9fa6319356c536b962650eda9399a44',\n          length: '28'\n      }],\n      dkim: 'failed',\n      spf: 'pass',\n      spamScore: 3.3,\n      language: 'english',\n      cc: [{\n        address: 'james@mail.com',\n        name: 'James'\n      }]\n  },\n  'dummyFile.txt': 'a-base64-encoded-string=='\n}\n```\n\n#####Gotchas\n* ```error: listen EACCES```: your user do not have sufficients privileges to run on the given port. Ports under 1000 are restricted to root user. Try with [sudo](http://xkcd.com/149/).\n* ```error: listen EADDRINUSE```: the current port is already used by something. Most likely, you are trying to use port 25 and your machine's [mail transport agent](http://en.wikipedia.org/wiki/Message_transfer_agent) is already running. Stop it with something like ```sudo service exim4 stop``` or ```sudo service postfix stop``` before using Mailin.\n* ```error: Unable to compute spam score ECONNREFUSED```: it is likely that spamassassin is not enabled on your machine, check the ```/etc/default/spamassassin``` file.\n* ```node: command not found```: most likely, your system does not have node installed or it is installed with a different name. For instance on Debian/Ubuntu, the node interpreter is called nodejs. The quick fix is making a symlink: ```ln -s $(which nodejs) /usr/bin/node``` to make the node command available.\n\n####Embedded inside a node application\n\nInstall Mailin locally.\n\n```\nsudo npm install --save mailin\n```\n\nStart the Mailin server and listen to events.\n\n```javascript\nvar mailin = require('mailin');\n\n/* Event emitted when a connection with the Mailin smtp server is initiated. */\nmailin.on('startMessage', function (messageInfo) {\n  /* messageInfo = {\n      from: 'sender@somedomain.com',\n      to: 'someaddress@yourdomain.com'\n  }; */\n  console.log(messageInfo);\n});\n\n/* Event emitted after a message was received and parsed.\n * The message parameters contains the parsed email. */\nmailin.on('message', function (message) {\n  console.log(message);\n  /* Do something useful with the parsed message here.\n   * Use it directly or modify it and post it to a webhook. */\n});\n\n/* Start the Mailin server. The available options are: \n *  options = {\n *     port: 25,\n *     webhook: 'http://mydomain.com/mailin/incoming,\n *     disableWebhook: false,\n *     logFile: '/some/local/path'\n *  };\n * Here disale the webhook posting so that you can do what you want with the\n * parsed message. */\nmailin.start({\n  port: 25,\n  disableWebhook: true // Disable the webhook posting.\n});\n```\n\n###Todo\nIf webhook fails, schedule some retries.\n\n\nNotice: Postman image copyright [Charlie Allen](http://charlieallensblog.blogspot.fr)\n",
  "readmeFilename": "README.md",
  "_id": "mailin@0.0.11",
  "_shasum": "b26851c604953832e77c73866e1d98deec57438b",
  "_from": "mailin@",
  "_resolved": "https://registry.npmjs.org/mailin/-/mailin-0.0.11.tgz"
}
